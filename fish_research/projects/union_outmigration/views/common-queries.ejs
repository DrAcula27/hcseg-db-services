<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Common Queries - Union Outmigration</title>
		<link rel="stylesheet" href="/css/global.css" />
		<link rel="stylesheet" href="/css/form.css" />
	</head>
	<body>
		<header class="header">
			<h1>Common Queries - Union River Outmigration</h1>
			<div class="header-auth">
				<p><strong>Logged in as:</strong> <%= user.username %></p>
				<a href="/projects" class="btn">Return to Projects</a>
			</div>
		</header>

		<main class="container">
			<section class="query-controls">
				<form method="get" action="">
					<label for="startDate">Start date:</label>
					<input type="date" id="startDate" name="startDate" value="<%= query.startDate || '' %>" />
					<label for="endDate">End date:</label>
					<input type="date" id="endDate" name="endDate" value="<%= query.endDate || '' %>" />
					<button type="submit" class="btn">Run</button>
				</form>
			</section>

			<section class="results">
				<h2>Summary Totals</h2>
				<ul>
					<li><strong>Chum caught:</strong> <%= totals.totalChum || 0 %></li>
					<li><strong>Chum morts:</strong> <%= totals.totalChumMorts || 0 %></li>
					<li><strong>Chum marked:</strong> <%= totals.totalChumMarked || 0 %></li>
					<li><strong>Chum recaptured:</strong> <%= totals.totalChumRecap || 0 %></li>
					<li><strong>Chum recapture morts:</strong> <%= totals.totalChumRecapMort || 0 %></li>
					<li><strong>Marked steelhead:</strong> <%= totals.totalSteelheadMarked || 0 %></li>
					<li><strong>Recaptured steelhead:</strong> <%= totals.totalSteelheadRecap || 0 %></li>
					<li><strong>Marked coho smolt:</strong> <%= totals.totalCohoSmoltMarked || 0 %></li>
					<li><strong>Recaptured coho smolt:</strong> <%= totals.totalCohoSmoltRecap || 0 %></li>
					<li><strong>Chum DNA samples taken (total):</strong> <%= totals.totalChumDnaTaken || 0 %></li>
				</ul>

				<h3>Stained Chum (heuristic: comments containing 'stain') </h3>
				<ul>
					<li><strong>Stained chum:</strong> <%= stained.stainedChum || 0 %></li>
					<li><strong>Stained chum morts:</strong> <%= stained.stainedChumMorts || 0 %></li>
				</ul>

				<h3>Other species breakdown</h3>
				<ul>
					<li><strong>Coho Fry:</strong> <%= totals.totalCohoFry || 0 %></li>
					<li><strong>Coho Smolt:</strong> <%= totals.totalCohoSmolt || 0 %></li>
					<li><strong>Coho Parr:</strong> <%= totals.totalCohoParr || 0 %></li>
					<li><strong>Steelhead:</strong> <%= totals.totalSteelhead || 0 %></li>
					<li><strong>Cutthroat:</strong> <%= totals.totalCutthroat || 0 %></li>
					<li><strong>Chinook:</strong> <%= totals.totalChinook || 0 %></li>
					<li><strong>Sculpin:</strong> <%= totals.totalSculpin || 0 %></li>
					<li><strong>Lamprey:</strong> <%= totals.totalLamprey || 0 %></li>
				</ul>

				<h3>DNA Samples (records)</h3>
				<% if (dnaRecords && dnaRecords.length) { %>
					<table class="results-table">
						<thead>
							<tr><th>Date</th><th>Count</th><th>Sample IDs</th></tr>
						</thead>
						<tbody>
							<% dnaRecords.forEach(function(r){ %>
								<tr>
									<td><%= r.Date ? r.Date.toISOString().slice(0,10) : '' %></td>
									<td><%= r['Chum DNA Taken'] %></td>
									<td><%= r['Chum DNA IDs'] || '' %></td>
								</tr>
							<% }) %>
						</tbody>
					</table>
				<% } else { %>
					<p>No DNA records found for the selected range.</p>
				<% } %>

				<h3>Trap Not Fishing Dates</h3>
				<% if (trapNotFishingDates && trapNotFishingDates.length) { %>
					<ul>
						<% trapNotFishingDates.forEach(function(d){ %>
							<li><%= d ? new Date(d).toISOString().slice(0,10) : '' %></li>
						<% }) %>
					</ul>
				<% } else { %>
					<p>No trap 'not fishing' records in the selected range.</p>
				<% } %>
			</section>
		</main>

		<footer id="footer">
			<p>&copy; HCSEG Data</p>
		</footer>
	</body>
</html>
